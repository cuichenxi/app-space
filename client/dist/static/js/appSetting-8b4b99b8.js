import{n as t,H as e,f as s,j as i,h as l}from"./index-7b75c17a.js";import"./vueRouter-5522c294.js";const r={};var a=t({components:{HeaderAppSelect:e},data:()=>({curApp:s.getCurApp(),appList:[],mergeList:[],curMerge:{},installType:"公开",publishType:"手动发布",installPwd:"",mergeAppId:"",showHistory:"是",diffNum:0,headerOperationData:["Bundle ID","App Key"],subTitleArr:[]}),created(){this.$nextTick((()=>{this.getAppDetailData()}))},mounted(){this.init()},methods:{init(){this.appList=s.getApps(),this.curApp=s.getCurApp(),this.mergeList=this.appList.filter((t=>"rn"!=t.platform&&t.platform!=this.curApp.platform&&t._id!=this.curApp._id)),this.installType=1===this.curApp.installWithPwd?"密码安装":"公开",this.publishType=!0===this.curApp.autoPublish?"自动发布":"手动发布",this.showHistory=!0===this.curApp.showHistory?"是":"否",this.installPwd=this.curApp.installPwd,this.mergeAppId=this.curApp.mergeAppId,this.diffNum=this.curApp.diffNum,this.curMerge=(this.mergeList||[]).find((t=>t._id==this.curApp.mergeAppId))||{}},clickSure(){if("密码安装"===this.installType&&""===this.installPwd)return void this.$message.error("密码不能为空");if(this.diffNum>10)return void this.$message.error("建议增量版本<=10");let t={shortUrl:this.curApp.shortUrl,appName:this.curApp.appName,installWithPwd:"公开"===this.installType?0:1,installPwd:this.installPwd,mergeAppId:this.curMerge._id,diffNum:this.diffNum,autoPublish:"手动发布"===this.publishType?0:1,showHistory:"是"===this.showHistory};i(this.curApp._id,t).then((t=>{t.success&&(this.$message.success(t.message),this.bus.$emit("refreshAppList"),this.bus.$emit("refreshAppInfo"))}),(t=>{}))},onMergeItemClick(t){this.curMerge=this.mergeList.find((e=>e._id==t._id))||{},console.log("this.curMerge",this.curMerge)},getAppDetailData(){this.curApp=s.getCurApp(),l(this.curApp._id).then((t=>{console.log(t),this.curApp=t.data,s.setCurApp(this.curApp),this.init(),this.subTitleArr=[],this.subTitleArr.push(this.curApp.bundleId),this.subTitleArr.push(this.curApp._id)}),(t=>{}))},updateAppInfoSuccess(){this.getAppDetailData()},getHost:()=>window.location.origin+"/"}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"appSetting-wrapper"},[s("div",{staticClass:"header"},[s("ul",t._l(this.headerOperationData,(function(e,i){return s("li",{key:i,staticClass:"itemWrapper"},[s("div",{staticClass:"topWrapper"},[s("p",{staticClass:"title"},[t._v(t._s(e))])]),t.curApp._id?s("div",{staticClass:"subWrapper"},[s("p",{staticClass:"subtitle"},[t._v(t._s(t.subTitleArr[i]))])]):t._e()])})),0)]),t._m(0),s("div",{staticClass:"content"},[s("el-form",{attrs:{labelWidth:"150px","label-position":"left"}},[s("el-form-item",{attrs:{label:"应用名称"}},[s("el-input",{staticClass:"shorturl",model:{value:t.curApp.appName,callback:function(e){t.$set(t.curApp,"appName",e)},expression:"curApp.appName"}})],1),s("el-form-item",{attrs:{label:"应用短链接"}},[t._v(" "+t._s(this.getHost())),s("el-input",{staticClass:"shorturl",model:{value:t.curApp.shortUrl,callback:function(e){t.$set(t.curApp,"shortUrl",e)},expression:"curApp.shortUrl"}})],1),s("el-form-item",{attrs:{label:"安装方式"}},[s("el-radio",{attrs:{label:"公开"},model:{value:t.installType,callback:function(e){t.installType=e},expression:"installType"}},[t._v("公开")]),s("el-radio",{attrs:{label:"密码安装"},model:{value:t.installType,callback:function(e){t.installType=e},expression:"installType"}},[t._v("密码安装")]),s("el-input",{directives:[{name:"show",rawName:"v-show",value:"密码安装"===t.installType,expression:"installType === '密码安装'"}],staticClass:"installtype",attrs:{type:"password",placeholder:"密码"},model:{value:t.installPwd,callback:function(e){t.installPwd=e},expression:"installPwd"}})],1),s("el-form-item",{attrs:{label:"发布方式"}},[s("el-radio",{attrs:{label:"手动发布"},model:{value:t.publishType,callback:function(e){t.publishType=e},expression:"publishType"}},[t._v("手动发布")]),s("el-radio",{attrs:{label:"自动发布"},model:{value:t.publishType,callback:function(e){t.publishType=e},expression:"publishType"}},[t._v("自动发布")])],1),s("el-form-item",{attrs:{label:"是否展示历史"}},[s("el-radio",{attrs:{label:"是"},model:{value:t.showHistory,callback:function(e){t.showHistory=e},expression:"showHistory"}},[t._v("展示")]),s("el-radio",{attrs:{label:"否"},model:{value:t.showHistory,callback:function(e){t.showHistory=e},expression:"showHistory"}},[t._v("不展示")])],1),"android"!=t.curApp.platform?s("el-form-item",{attrs:{label:"增量版本个数"}},[s("el-input",{staticClass:"shorturl",attrs:{type:"number"},model:{value:t.diffNum,callback:function(e){t.diffNum=e},expression:"diffNum"}})],1):t._e(),"rn"!=t.curApp.platform?s("el-form-item",{attrs:{label:"合并应用"}},[s("el-dropdown",{attrs:{placement:"bottom-start",size:"medium"}},[s("div",{staticClass:"el-dropdown-link merge-select"},[t.curMerge._id?s("header-app-select",{attrs:{item:t.curMerge}}):t._e(),t.curMerge._id?t._e():s("span",[t._v("请选择合并应用")]),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})],1),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t._l(t.mergeList,(function(e){return s("el-dropdown-item",{key:e._id},[s("div",{on:{click:function(s){return t.onMergeItemClick(e)}}},[s("header-app-select",{attrs:{item:e}})],1)])})),s("el-dropdown-item",{attrs:{divided:""}},[s("div",{on:{click:function(e){return t.onMergeItemClick({})}}},[t._v(" 解除合并 ")])])],2)],1)],1):t._e()],1),s("button",{staticClass:"bottomBtn button-style-border",attrs:{type:"button"},on:{click:t.clickSure}},[t._v("立即生效")])],1)])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top"},[s("i",{staticClass:"el-icon-setting"}),t._v(" 设置 ")])}],!1,p,null,null,null);function p(t){for(let e in r)this[e]=r[e]}var o=function(){return a.exports}();export{o as default};
