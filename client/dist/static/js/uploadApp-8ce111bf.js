import{n as e,k as s,l as t}from"./index-7b75c17a.js";const a={props:{appFile:{type:FileList},appInfo:{type:Object}},data:()=>({progress:0,source:null}),created(){this.$nextTick((()=>{this.beginLoad()}))},methods:{cancelUpload(){this.source&&this.source.cancel("取消上传"),this.$emit("closeUpload")},beginLoad(){const e=this;let a=s.CancelToken;if(e.source=a.source(),this.appFile[0].size>20971520)return t.exports.Message.error("系统限制50M"),void this.$emit("closeUpload");let o=new FormData;o.append("appId",this.appInfo._id),o.append("active",this.appInfo.autoPublish),o.append("platform",this.appInfo.platform),o.append("file",this.appFile[0]);let p={onUploadProgress:function(s){let t=Math.round(100*s.loaded/s.total);e.$nextTick((()=>{e.progress=t}))},cancelToken:e.source.token,timeout:36e6};s.defaults.headers.common["Content-Type"]="multipart/form-data",s.defaults.timeout=6e6,s.post("api/apps/upload",o,p).then((e=>{console.log(e),t.exports.Message({message:e.data.success?"上传成功":e.data.message,type:e.data.success?"success":"error"}),e.data.success?this.$emit("uploadSuccess",e.data):this.$emit("closeUpload")})).catch((function(e){s.isCancel(e)?console.log("Request canceled",e.message):(t.exports.Message.error("上传失败"),this.$emit("closeUpload"))}))}}},o={};var p=e(a,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"uploadApp-wrapper"},[t("div",{staticClass:"uploadContent"},[t("img",{attrs:{src:"/assets/loadding.accf0f87.gif"}}),t("div",{staticStyle:{"font-size":"20px","margin-top":"30px",color:"#229FFC"},domProps:{innerHTML:e._s("正在上传中...".concat(e.progress,"%"))}})])])}),[],!1,i,null,null,null);function i(e){for(let s in o)this[s]=o[s]}var n=function(){return p.exports}();export{n as U};
