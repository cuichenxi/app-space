import{l as s,a as e,b as i}from"./loginApi-77f6847f.js";import{n as t,F as o,G as r,x as a}from"./index-7b75c17a.js";import"./vueRouter-5522c294.js";const n={};var l=t({data:()=>({username:"",password:"",isLogin:!1,errorInfo:"",showType:"login",email:"",showLoading:!1}),created(){this.$nextTick((()=>{}))},components:{},methods:{onSubmit(){"login"===this.showType?this.login():"register"===this.showType?this.regist():this.requestPassword()},onRegister(){this.showType="register"===this.showType?"login":"register"},onForget(){this.$prompt("请输入邮箱,我们会发送新密码到您到邮箱","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:"邮箱格式不正确"}).then((({value:s})=>{this.email=s,this.requestPassword()})).catch((s=>{this.$message({type:"info",message:s})}))},login(){if(0===this.username.length)return void(this.errorInfo="* 用户名不能为空");if(0===this.password.length)return void(this.errorInfo="* 密码不能为空");this.errorInfo="";let e={username:this.username,password:this.password};this.showLoading=!0,s(e).then((s=>{console.log(s),this.showLoading=!1,o.add(this.axios.baseURL,s.data.token);let e={userName:this.username,userId:s.data._id,permission:s.data.permission,email:s.data.email,apiToken:s.data.apiToken};r(e),this.$router.push("/")}),(s=>{this.showLoading=!1}))},regist(){if(0===this.username.length)return void this.$message.error("用户名不能为空");if(0===this.email.length)return void this.$message.error("邮箱不能为空");if(!a.valideEmail(this.email))return void this.$message.error("邮箱格式错误");if(0===this.password.length)return void this.$message.error("密码不能为空");let s={username:this.username,password:this.password,email:this.email};this.showLoading=!0,e(s).then((s=>{this.showLoading=!1,console.log(s),this.$message({message:"恭喜你，注册成功",type:"success"}),setTimeout((()=>{this.onRegister()}),500)}),(s=>{this.showLoading=!1}))},requestPassword(){0!==this.email.length?i({email:this.email}).then((s=>{console.log(s),this.$message({message:"密码已重置,新密码已通过邮件发送至您的邮箱.",type:"success"})}),(s=>{console.log(s),this.$message.error(s)})):this.$message.error("邮箱不能为空")},clickSubItem(s){if("api"===s){let s=`${this.axios.defaults.baseURL}api/swagger`;window.open(s,"_blank")}if("help"===s){let s=`http://wiki.${this.axios.defaults.baseURL.replace("https://","").replace("http://","").replace("www.","")}`;console.log(s),window.open(s,"_blank")}if("github"===s){let s="https://github.com/HeadingMobile";window.open(s,"_blank")}s.index}}},(function(){var s=this,e=s.$createElement,i=s._self._c||e;return i("div",{staticClass:"user"},[i("div",{staticClass:"user-right"},[i("div",{staticClass:"user-login-panel"},["login"===s.showType?i("div",{staticClass:"user-login-title"},[i("p",[s._v(" 登录")])]):s._e(),"register"===s.showType?i("div",{staticClass:"user-login-title"},[i("p",[s._v(" 注册")])]):s._e(),"forget"===s.showType?i("div",{staticClass:"user-login-title"},[i("p",[s._v("找回密码")])]):s._e(),i("div",{class:["login"===s.showType?"user-login-form":"user-register-form"]},[i("el-input",{staticClass:"user-login-form-input",attrs:{type:"text",placeholder:"请输入用户名","prefix-icon":"icon-ic_name"},model:{value:s.username,callback:function(e){s.username=e},expression:"username"}}),"register"===s.showType?i("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"请输入邮箱",type:"email","prefix-icon":"icon-ic_email"},model:{value:s.email,callback:function(e){s.email=e},expression:"email"}}):s._e(),i("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"icon-ic_pswd"},model:{value:s.password,callback:function(e){s.password=e},expression:"password"}}),i("el-button",{class:["login"===s.showType?"user-login-form-btn":"user-register-form-btn"],attrs:{type:"submit",loading:s.showLoading},on:{click:s.onSubmit}},[s._v(s._s("login"===s.showType?"立即登录":"立即注册")+" ")]),"login"===s.showType?i("div",{staticClass:"user-login-form-label"},[i("p",[i("span",{on:{click:s.onRegister}},[s._v("没有账号？立即注册")])])]):s._e(),"register"===s.showType?i("div",{staticClass:"user-login-form-label"},[i("p",[i("span",{on:{click:s.onRegister}},[s._v("已有账号？现在登录")])])]):s._e(),i("div",{staticClass:"user-login-form-label user-login-form-bottom"},[i("p",{on:{click:s.onForget}},[s._v("忘记密码")])])],1)])])])}),[],!1,h,null,null,null);function h(s){for(let e in n)this[e]=n[e]}var p=function(){return l.exports}();export{p as default};
